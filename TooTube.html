<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TooTube Yellow | Все в одному</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    
    <style>
        :root { --accent: #FFD600; --bg: #050505; --sidebar: #111; --border: #252525; --text: #fff; --gray: #909090; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: var(--text); overflow: hidden; }
        .hidden { display: none !important; }

        /* AUTH */
        #page-auth { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: var(--sidebar); padding: 40px; border-radius: 30px; border: 1px solid var(--border); width: 350px; text-align: center; }

        /* LAYOUT */
        .app-container { display: flex; height: 100vh; }
        aside { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 30px 15px; display: flex; flex-direction: column; gap: 8px; }
        .logo { font-size: 26px; font-weight: 800; margin-bottom: 40px; text-align: center; cursor: pointer; }
        .logo span { color: var(--accent); }
        
        .nav-item { display: flex; align-items: center; gap: 15px; padding: 14px 20px; border-radius: 12px; cursor: pointer; color: var(--gray); font-weight: 600; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: var(--accent); color: #000; }

        main { flex: 1; overflow-y: auto; position: relative; background: var(--bg); }
        header { position: sticky; top: 0; background: rgba(5,5,5,0.8); backdrop-filter: blur(15px); height: 80px; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; z-index: 900; border-bottom: 1px solid var(--border); }

        /* GRID */
        .v-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 30px; }
        .v-card { cursor: pointer; background: #0c0c0c; padding: 10px; border-radius: 20px; border: 1px solid transparent; transition: 0.3s; }
        .v-card:hover { border-color: var(--accent); }
        .v-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 15px; overflow: hidden; background: #000; margin-bottom: 10px; }
        .v-thumb video { width: 100%; height: 100%; object-fit: cover; }

        /* WATCH PAGE */
        .watch-area { max-width: 1000px; margin: 0 auto; padding: 30px; }
        .comm-input-group { display: flex; gap: 10px; margin: 20px 0; }
        .comm-item { background: #181818; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 3px solid var(--accent); }

        /* SHORTS */
        #page-shorts { height: calc(100vh - 80px); overflow-y: scroll; scroll-snap-type: y mandatory; display: flex; flex-direction: column; align-items: center; }
        .short-frame { height: 90%; aspect-ratio: 9/16; scroll-snap-align: center; background: #000; border-radius: 25px; margin: 20px 0; position: relative; border: 2px solid var(--border); }
        .short-frame video { width: 100%; height: 100%; object-fit: cover; border-radius: 23px; }
        .short-ui { position: absolute; right: -60px; bottom: 40px; display: flex; flex-direction: column; gap: 15px; }

        /* UI */
        .btn { padding: 12px 24px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-p { background: var(--accent); color: #000; }
        .btn-s { background: #222; color: #fff; }
        input, textarea, select { width: 100%; padding: 14px; background: #000; border: 1px solid #333; color: white; border-radius: 12px; margin-bottom: 15px; outline: none; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; }
        .studio-card { background: var(--sidebar); width: 850px; border-radius: 30px; display: grid; grid-template-columns: 1fr 1fr; overflow: hidden; border: 1px solid var(--border); }
    </style>
</head>
<body>

    <div id="page-auth">
        <div class="auth-card">
            <h1 class="logo">Too<span>Tube</span></h1>
            <input type="text" id="auth-user" placeholder="Ваш нікнейм">
            <input type="password" id="auth-pass" placeholder="Пароль">
            <button class="btn btn-p" style="width: 100%; justify-content: center;" onclick="app.auth()">ПОЧАТИ</button>
        </div>
    </div>

    <div id="app-ui" class="app-container hidden">
        <aside>
            <div class="logo" onclick="app.nav('home')">Too<span>Tube</span></div>
            <div class="nav-item active" id="nav-home" onclick="app.nav('home')"><span class="material-icons-round">home</span> Головна</div>
            <div class="nav-item" id="nav-shorts" onclick="app.nav('shorts')"><span class="material-icons-round">bolt</span> Shorts</div>
            <div class="nav-item" id="nav-analytics" onclick="app.nav('analytics')"><span class="material-icons-round">analytics</span> Аналітика</div>
            <div style="margin-top: auto;" class="nav-item" onclick="app.logout()"><span class="material-icons-round">logout</span> Вийти</div>
        </aside>

        <main>
            <header>
                <div style="background: #151515; border: 1px solid var(--border); border-radius: 12px; display: flex; align-items: center; padding: 0 15px; width: 400px;">
                    <span class="material-icons-round" style="color:var(--gray)">search</span>
                    <input type="text" placeholder="Пошук..." oninput="app.search(this.value)" style="margin:0; border:none; background:transparent; width:100%; color:white; padding:12px;">
                </div>
                <button class="btn btn-p" onclick="document.getElementById('file-picker').click()"><span class="material-icons-round">add</span> СТВОРИТИ</button>
            </header>

            <div id="page-home" class="hidden"><div class="v-grid" id="home-feed"></div></div>
            <div id="page-shorts" class="hidden"></div>
            <div id="page-analytics" class="hidden" style="padding:40px;">
                <h2>Мій канал</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin:20px 0;">
                    <div style="background:var(--sidebar); padding:20px; border-radius:20px; text-align:center;"><h1 id="stat-v">0</h1><p>Відео</p></div>
                    <div style="background:var(--sidebar); padding:20px; border-radius:20px; text-align:center;"><h1 id="stat-l">0</h1><p>Лайки</p></div>
                </div>
                <h3>Мої завантаження</h3>
                <div id="my-vids-list" style="margin-top:15px;"></div>
            </div>

            <div id="page-watch" class="hidden">
                <div class="watch-area">
                    <video id="v-player" style="width:100%; border-radius:20px; background:#000;" controls autoplay></video>
                    <div style="margin-top:20px;">
                        <h1 id="v-title"></h1>
                        <p id="v-author" style="color:var(--accent); font-weight:800; margin:10px 0;"></p>
                        <p id="v-desc" style="color:var(--gray); white-space: pre-wrap; margin-bottom:20px;"></p>
                        <button class="btn btn-s" onclick="app.like()"><span class="material-icons-round">thumb_up</span> <span id="v-likes">0</span></button>
                    </div>
                    <div style="margin-top:30px; border-top:1px solid var(--border); padding-top:20px;">
                        <h3>Коментарі</h3>
                        <div class="comm-input-group">
                            <input type="text" id="c-input" placeholder="Напишіть коментар..." style="margin:0">
                            <button class="btn btn-p" onclick="app.postComm()">ОК</button>
                        </div>
                        <div id="c-list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="studio-modal">
        <div class="studio-card">
            <video id="st-preview" muted loop style="width:100%; height:100%; object-fit: cover;"></video>
            <div style="padding:30px;">
                <h2>Студія</h2>
                <input type="text" id="st-title" placeholder="Назва відео">
                <textarea id="st-desc" placeholder="Опис (розкажіть про що відео...)" style="height:120px;"></textarea>
                <select id="st-type"><option value="video">Звичайне відео</option><option value="short">Shorts</option></select>
                <button class="btn btn-p" id="pub-btn" style="width:100%; justify-content:center;" onclick="app.publish()">ОПУБЛІКУВАТИ</button>
                <button class="btn btn-s" style="width:100%; justify-content:center; margin-top:10px;" onclick="app.closeStudio()">СКАСУВАТИ</button>
            </div>
        </div>
    </div>

    <input type="file" id="file-picker" hidden accept="video/*" onchange="app.openStudio(this)">

    <script>
        const app = {
            db: null, user: JSON.parse(localStorage.getItem('tt_v30_user')), currentVid: null,
            init() {
                const req = indexedDB.open("TooTube_V30", 1);
                req.onupgradeneeded = e => {
                    const db = e.target.result;
                    db.createObjectStore("vids", { keyPath: "id", autoIncrement: true });
                    db.createObjectStore("users", { keyPath: "login" });
                };
                req.onsuccess = e => { this.db = e.target.result; if(this.user) this.showApp(); };
            },
            async auth() {
                const l = document.getElementById('auth-user').value.trim(), p = document.getElementById('auth-pass').value.trim();
                if(!l || !p) return;
                const tx = this.db.transaction("users", "readwrite");
                const store = tx.objectStore("users");
                const user = await new Promise(res => { const r = store.get(l); r.onsuccess = () => res(r.result); });
                if(!user) store.add({ login: l, pass: p });
                else if(user.pass !== p) return alert("Пароль невірний");
                this.user = { name: l }; localStorage.setItem('tt_v30_user', JSON.stringify(this.user));
                this.showApp();
            },
            showApp() {
                document.getElementById('page-auth').classList.add('hidden');
                document.getElementById('app-ui').classList.remove('hidden');
                this.nav('home');
            },
            nav(page) {
                document.querySelectorAll('main > div').forEach(p => p.classList.add('hidden'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('page-' + page).classList.remove('hidden');
                if(document.getElementById('nav-'+page)) document.getElementById('nav-'+page).classList.add('active');
                if(page === 'home') this.renderFeed();
                if(page === 'shorts') this.renderShorts();
                if(page === 'analytics') this.renderAnalytics();
            },
            renderFeed(q = "") {
                const grid = document.getElementById('home-feed'); grid.innerHTML = "";
                this.db.transaction("vids", "readonly").objectStore("vids").openCursor().onsuccess = e => {
                    const cur = e.target.result;
                    if(cur) {
                        const v = cur.value;
                        if(v.type === 'video' && v.title.toLowerCase().includes(q.toLowerCase())) {
                            const url = URL.createObjectURL(new Blob([v.data]));
                            const card = document.createElement('div'); card.className = "v-card";
                            card.innerHTML = `<div class="v-thumb"><video src="${url}#t=0.5"></video></div><b>${v.title}</b><p style="color:gray;font-size:12px;">@${v.author}</p>`;
                            card.onclick = () => { this.currentVid = v; this.nav('watch'); document.getElementById('v-player').src = url; document.getElementById('v-title').innerText = v.title; document.getElementById('v-author').innerText = "@"+v.author; document.getElementById('v-desc').innerText = v.desc; document.getElementById('v-likes').innerText = v.likes || 0; this.renderComms(); };
                            grid.prepend(card);
                        }
                        cur.continue();
                    }
                };
            },
            renderShorts() {
                const container = document.getElementById('page-shorts'); container.innerHTML = "";
                this.db.transaction("vids", "readonly").objectStore("vids").openCursor().onsuccess = e => {
                    const cur = e.target.result;
                    if(cur) {
                        if(cur.value.type === 'short') {
                            const v = cur.value; const url = URL.createObjectURL(new Blob([v.data]));
                            const frame = document.createElement('div'); frame.className = "short-frame";
                            frame.innerHTML = `<video src="${url}" loop playsinline onclick="this.paused ? this.play() : this.pause()"></video>
                                <div class="short-ui">
                                    <button class="btn btn-s" style="border-radius:50%; width:50px; height:50px; padding:0; justify-content:center;" onclick="app.likeShort(${v.id}, this)"><span class="material-icons-round">favorite</span></button>
                                    <button class="btn btn-s" style="border-radius:50%; width:50px; height:50px; padding:0; justify-content:center;" onclick="alert('Опис: ${v.desc}')"><span class="material-icons-round">info</span></button>
                                </div>
                                <div style="position:absolute; bottom:20px; left:20px; text-shadow: 0 2px 4px rgba(0,0,0,0.5);"><b>@${v.author}</b><p>${v.title}</p></div>`;
                            container.appendChild(frame);
                        }
                        cur.continue();
                    }
                };
            },
            renderAnalytics() {
                const list = document.getElementById('my-vids-list'); list.innerHTML = "";
                let vCount = 0, lCount = 0;
                this.db.transaction("vids", "readonly").objectStore("vids").openCursor().onsuccess = e => {
                    const cur = e.target.result;
                    if(cur) {
                        const v = cur.value;
                        if(v.author === this.user.name) {
                            vCount++; lCount += (v.likes || 0);
                            list.innerHTML += `<div style="display:flex; justify-content:space-between; background:#181818; padding:15px; border-radius:12px; margin-bottom:10px; border:1px solid var(--border);">
                                <span>${v.title} (${v.type})</span>
                                <button onclick="app.del(${v.id})" style="color:red; background:none; border:none; cursor:pointer;">Видалити</button>
                            </div>`;
                        }
                        cur.continue();
                    } else {
                        document.getElementById('stat-v').innerText = vCount;
                        document.getElementById('stat-l').innerText = lCount;
                    }
                };
            },
            openStudio(i) {
                this.tempFile = i.files[0]; if(!this.tempFile) return;
                document.getElementById('st-preview').src = URL.createObjectURL(this.tempFile);
                document.getElementById('studio-modal').style.display = 'flex';
                document.getElementById('st-title').value = this.tempFile.name.split('.')[0];
            },
            publish() {
                const btn = document.getElementById('pub-btn'); btn.disabled = true; btn.innerText = "ЗБЕРЕЖЕННЯ...";
                const reader = new FileReader(); reader.readAsArrayBuffer(this.tempFile);
                reader.onload = () => {
                    const tx = this.db.transaction("vids", "readwrite");
                    tx.objectStore("vids").add({
                        title: document.getElementById('st-title').value,
                        desc: document.getElementById('st-desc').value,
                        type: document.getElementById('st-type').value,
                        author: this.user.name, likes: 0, comms: [], data: reader.result
                    });
                    tx.oncomplete = () => { this.closeStudio(); this.nav('home'); btn.disabled = false; btn.innerText = "ОПУБЛІКУВАТИ"; };
                };
            },
            like() { this.currentVid.likes++; document.getElementById('v-likes').innerText = this.currentVid.likes; this.saveVid(this.currentVid); },
            likeShort(id, btn) { btn.style.color = "var(--accent)"; this.db.transaction("vids", "readwrite").objectStore("vids").get(id).onsuccess = e => { let v = e.target.result; v.likes++; this.db.transaction("vids", "readwrite").objectStore("vids").put(v); } },
            postComm() {
                const inp = document.getElementById('c-input'); if(!inp.value.trim()) return;
                this.currentVid.comms.push({ user: this.user.name, text: inp.value });
                this.saveVid(this.currentVid); inp.value = ""; this.renderComms();
            },
            renderComms() {
                document.getElementById('c-list').innerHTML = this.currentVid.comms.map(c => `<div class="comm-item"><b>@${c.user}</b><p>${c.text}</p></div>`).reverse().join('');
            },
            saveVid(v) { this.db.transaction("vids", "readwrite").objectStore("vids").put(v); },
            del(id) { if(confirm("Видалити це відео?")) this.db.transaction("vids", "readwrite").objectStore("vids").delete(id).onsuccess = () => this.renderAnalytics(); },
            search(q) { this.renderFeed(q); },
            closeStudio() { document.getElementById('studio-modal').style.display = 'none'; },
            logout() { localStorage.clear(); location.reload(); }
        };
        app.init();
    </script>
</body>
</html>